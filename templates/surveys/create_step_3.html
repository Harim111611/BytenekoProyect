{% extends "base_dashboard.html" %}
{% load static %}

{% block title %}Crear Encuesta · Paso 3{% endblock %}

{% block content %}
<div class="container-fluid py-3">

  <div class="d-flex justify-content-between align-items-end mb-1">
    <div>
      <h1 class="h3 mb-1">Crear Encuesta</h1>
      <div class="text-muted">Sigue los pasos para crear tu encuesta profesional</div>
    </div>
    <div class="small text-muted">{{ progress|default:100 }}% completado</div>
  </div>

  <div class="progress mb-3" style="height:6px">
    <div class="progress-bar bg-dark" style="width: {{ progress|default:100 }}%"></div>
  </div>

  {% include "surveys/_stepper.html" with step=3 progress=progress %}

  <div class="alert alert-info bg-opacity-25 border-0">
    <div class="fw-semibold">Paso 3: Revisión y publicación</div>
    <div>Verifica la información antes de publicar. Puedes regresar a corregir si lo necesitas.</div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <h6 class="text-uppercase text-muted">Datos generales</h6>
      <div class="mb-3">
        <div><span class="text-muted">Nombre:</span> <strong>{{ draft.basic.name }}</strong></div>
        <div><span class="text-muted">Categoría:</span> <strong>{{ draft.basic.category }}</strong></div>
        {% if draft.basic.description %}
          <div class="mt-1"><span class="text-muted">Descripción:</span> {{ draft.basic.description }}</div>
        {% endif %}
      </div>

      <h6 class="text-uppercase text-muted">Preguntas</h6>
      <ol class="list-group list-group-numbered">
        {% for q in draft.questions %}
          <li class="list-group-item">
            <div class="fw-semibold">{{ q.text }}</div>
            <div class="text-muted small">Tipo: {{ q.qtype }}{% if q.required %} · Requerida{% endif %}</div>
            {% if q.options and q.options|length %}
              <div class="small mt-1">
                <span class="text-muted">Opciones: </span>{{ q.options|join:", " }}
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ol>
    </div>

    <div class="card-footer bg-white d-flex justify-content-between">
      <form method="post" class="m-0">
        {% csrf_token %}
        <input type="hidden" name="action" value="back">
        <button type="submit" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left-short fs-5 me-1"></i> Volver a preguntas
        </button>
      </form>
      <form method="post" class="m-0">
        {% csrf_token %}
        <input type="hidden" name="action" value="publish">
        <button type="submit" class="btn btn-dark">
          Publicar encuesta <i class="bi bi-check-circle ms-1"></i>
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
